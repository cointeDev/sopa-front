<div class="gestor-painel">

  <header class="gestor-header">
    <nav class="gestor-nav">
      <a (click)="mudarAba('dashboard')" [class.active]="abaAtual === 'dashboard'">Dashboard</a>
      <a (click)="mudarAba('quadro')" [class.active]="abaAtual === 'quadro'">Quadro de Produ√ß√£o</a>
      <a (click)="mudarAba('agenda')" [class.active]="abaAtual === 'agenda'">Agenda do Est√∫dio</a>
    </nav>
    <div class="gestor-actions">
      <button class="btn-novo-card" (click)="openModal()">+ Novo Card</button>
      <a routerLink="/" class="btn-sair">Sair</a>
    </div>
  </header>

  <div class="gestor-conteudo">

    <div class="gestor-saudacao">
      <h2>{{ greeting }}, {{ userName }}!</h2>
      <p>Aqui est√° o resumo do seu est√∫dio hoje.</p>
    </div>

    <div class="aba" *ngIf="abaAtual === 'dashboard'">
      <h2>Dashboard (A√ß√µes Pendentes + BI)</h2>
      <p>(Conte√∫do do Dashboard aqui...)</p>
    </div>

    <div class="aba" *ngIf="abaAtual === 'quadro'" cdkDropListGroup>

      <div class="board-controls">
        <h2>Quadro de Produ√ß√£o</h2>
        <div class="view-toggle">
          <button (click)="mudarVisao('focada')" [class.active]="visaoQuadro === 'focada'">‚ò∑ Vis√£o Focada</button>
          <button (click)="mudarVisao('geral')" [class.active]="visaoQuadro === 'geral'">‚†ø Vis√£o Geral</button>
        </div>
      </div>

      <div class="operacionais-atribuicao-flutuante">
        <h3>Equipe do Est√∫dio:</h3>
        <div class="lista-operacionais">
          <div *ngFor="let op of listaOperacionais" class="operacional-button" [style.background-color]="op.cor">
            <div class="nome-op">{{ op.nome.split(' ')[0] }}</div>
            <small>{{ op.perfil }}</small>
          </div>
        </div>
      </div>

      <div class="board-shortcut-bar">
        <label>Ir para etapa:</label>
        <select (change)="scrollToColumn($event)">
          <option value="" disabled selected>Selecione...</option>
          <option *ngFor="let col of colunasNavegacao" [value]="col.id">{{ col.label }}</option>
        </select>
      </div>

      <div class="board-view-general" *ngIf="visaoQuadro === 'geral'">
        <div class="board-container-scroll" cdkDropListGroup>

          <ng-template #columnTemplate let-lista="lista" let-id="id" let-titulo="titulo">
            <div class="board-list" [id]="id">
              <div class="board-list-header">
                <h3>{{ titulo }}</h3>
                <button class="maximize-btn" (click)="focarLista(id)">‚Üó</button>
              </div>
              <div class="cards" cdkDropList [cdkDropListData]="lista" [cdkDropListEnterPredicate]="isCardPredicate"
                (cdkDropListDropped)="drop($event)">
                <div *ngFor="let card of lista" class="board-card" cdkDrag [cdkDragData]="card">
                  <div class="card-header-info">
                    <span class="card-tag" [class.tag-enem]="card.programa === 'enem'"
                      [class.tag-rieh]="card.programa === 'rieh'">{{ card.programa === 'enem' ? 'Se Liga no Enem' :
                      'RIEH' }}</span>
                    <span class="card-id">#{{ card.id }}</span>
                  </div>
                  <h4>{{ card.titulo }}</h4>
                  <div class="card-meta"
                    style="font-size: 0.8rem; color: #6B7280; margin-bottom: 0.5rem; display:flex; align-items:center; gap:0.3rem;">
                    <span>üìÖ</span><span *ngIf="card.prazo">{{ card.prazo | date:'dd/MM' }}</span><span
                      *ngIf="!card.prazo">Sem prazo</span></div>
                  <div class="card-footer" [style.border-top]="'3px solid ' + getResponsavelCor(card.responsavel)">
                    <div class="resp-selector-container" style="display:flex; flex-direction:column; width:85%;">
                      <label class="resp-label">Respons√°vel:</label>
                      <select class="resp-select" (change)="mudarResponsavel(card, $event)"
                        (click)="$event.stopPropagation()"
                        [style.color]="card.responsavel ? getResponsavelCor(card.responsavel) : '#6B7280'"
                        [style.font-weight]="card.responsavel ? '700' : '400'">
                        <option value="" [selected]="!card.responsavel">-- Atribuir --</option>
                        <option *ngFor="let op of listaOperacionais" [value]="op.id"
                          [selected]="card.responsavel === op.id">{{ op.nome }}</option>
                      </select>
                    </div>
                    <div class="resp-avatar" [style.background-color]="getResponsavelCor(card.responsavel)"
                      style="width: 14px; height: 14px; border-radius: 50%;"></div>
                  </div>
                </div>
              </div>
            </div>
          </ng-template>

          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: standby, id: 'standby', titulo: 'Standby' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: paraProducaoSemanal, id: 'para-producao-semanal', titulo: 'Para Produ√ß√£o Semanal' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: aoVivo, id: 'ao-vivo', titulo: 'Ao Vivo' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: gravado, id: 'gravado', titulo: 'Gravado' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: edicao1, id: 'edicao1', titulo: 'Edi√ß√£o 1 (Decupagem)' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: edicao2, id: 'edicao2', titulo: 'Edi√ß√£o 2 (Ilustra√ß√£o)' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: edicao3, id: 'edicao3', titulo: 'Edi√ß√£o 3' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: edicaoFinal, id: 'edicao-final', titulo: 'Edi√ß√£o Final' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: libras, id: 'libras', titulo: 'Estudo / Grava√ß√£o Libras' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: revisaoLP, id: 'revisao-lp', titulo: 'Revis√£o LP' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: producaoLSE, id: 'producao-lse', titulo: 'Produ√ß√£o LSE' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: concluido, id: 'concluido', titulo: 'Conclu√≠do' }"></ng-container>
          <ng-container
            *ngTemplateOutlet="columnTemplate; context: { lista: publicado, id: 'publicado', titulo: 'Publicado no Youtube' }"></ng-container>
        </div>
      </div>

      <div class="board-view-focused" *ngIf="visaoQuadro === 'focada'">
        <ng-template #focusedColumnTemplate let-lista="lista" let-id="id" let-titulo="titulo">
          <div class="board-list" *ngIf="listaFocada === id">
            <div class="board-list-header">
              <h3>{{ titulo }}</h3><button class="maximize-btn" (click)="focarLista(id)">‚Üô</button>
            </div>
            <div class="cards" cdkDropList [cdkDropListData]="lista" [cdkDropListEnterPredicate]="isCardPredicate"
              (cdkDropListDropped)="drop($event)">
              <div *ngFor="let card of lista" class="board-card" cdkDrag [cdkDragData]="card">
                <div class="card-header-info"><span class="card-tag" [class.tag-enem]="card.programa === 'enem'"
                    [class.tag-rieh]="card.programa === 'rieh'">{{ card.programa === 'enem' ? 'Se Liga no Enem' : 'RIEH'
                    }}</span><span class="card-id">#{{ card.id }}</span></div>
                <h4>{{ card.titulo }}</h4>
                <div class="card-meta"
                  style="font-size: 0.8rem; color: #6B7280; margin-bottom: 0.5rem; display:flex; align-items:center; gap:0.3rem;">
                  <span>üìÖ</span><span *ngIf="card.prazo">{{ card.prazo | date:'dd/MM' }}</span><span
                    *ngIf="!card.prazo">Sem prazo</span></div>
                <div class="card-footer" [style.border-top]="'3px solid ' + getResponsavelCor(card.responsavel)">
                  <div class="resp-selector-container" style="display:flex; flex-direction:column; width:85%;">
                    <label class="resp-label">Respons√°vel:</label>
                    <select class="resp-select" (change)="mudarResponsavel(card, $event)"
                      (click)="$event.stopPropagation()"
                      [style.color]="card.responsavel ? getResponsavelCor(card.responsavel) : '#6B7280'"
                      [style.font-weight]="card.responsavel ? '700' : '400'">
                      <option value="" [selected]="!card.responsavel">-- Atribuir --</option>
                      <option *ngFor="let op of listaOperacionais" [value]="op.id"
                        [selected]="card.responsavel === op.id">{{ op.nome }}</option>
                    </select>
                  </div>
                  <div class="resp-avatar" [style.background-color]="getResponsavelCor(card.responsavel)"
                    style="width: 14px; height: 14px; border-radius: 50%;"></div>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: standby, id: 'standby', titulo: 'Standby' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: paraProducaoSemanal, id: 'para-producao-semanal', titulo: 'Para Produ√ß√£o Semanal' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: aoVivo, id: 'ao-vivo', titulo: 'Ao Vivo' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: gravado, id: 'gravado', titulo: 'Gravado' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: edicao1, id: 'edicao1', titulo: 'Edi√ß√£o 1 (Decupagem)' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: edicao2, id: 'edicao2', titulo: 'Edi√ß√£o 2 (Ilustra√ß√£o)' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: edicao3, id: 'edicao3', titulo: 'Edi√ß√£o 3' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: edicaoFinal, id: 'edicao-final', titulo: 'Edi√ß√£o Final' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: libras, id: 'libras', titulo: 'Estudo / Grava√ß√£o Libras' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: revisaoLP, id: 'revisao-lp', titulo: 'Revis√£o LP' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: producaoLSE, id: 'producao-lse', titulo: 'Produ√ß√£o LSE' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: concluido, id: 'concluido', titulo: 'Conclu√≠do' }"></ng-container>
        <ng-container
          *ngTemplateOutlet="focusedColumnTemplate; context: { lista: publicado, id: 'publicado', titulo: 'Publicado no Youtube' }"></ng-container>
      </div>
    </div>

    <div class="aba" *ngIf="abaAtual === 'agenda'">
      <h2>Agenda do Est√∫dio (Calend√°rio)</h2>
    </div>

  </div>
</div>

<div id="create-card-modal" class="modal-overlay" *ngIf="isModalOpen">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Cadastrar Processo</h2><span class="close-btn" (click)="closeModal()">&times;</span>
    </div>
    <form (submit)="confirmarCriacaoCard()">
      <div class="form-row-wide">
        <div class="form-group" style="margin-bottom: 1.5rem;"><label>T√≠tulo do Pedido</label><input type="text"
            [(ngModel)]="novoCardData.titulo" name="titulo" required placeholder="Ex: Aula de Matem√°tica - Fun√ß√µes">
        </div>
      </div>
      <div class="form-row-wide">
        <div class="form-group"><label>Solicitante</label><input type="text" [(ngModel)]="novoCardData.solicitante"
            name="solicitante" required placeholder="Ex: Prof. Carlos"></div>
        <div class="form-group"><label>Tipo de Material</label><select [(ngModel)]="novoCardData.tipo" name="tipo"
            (change)="atualizarEtapasPadrao()">
            <option value="videoaula">Videoaula</option>
            <option value="podcast">Podcast</option>
            <option value="reels">Reels/Short</option>
            <option value="live">Live</option>
          </select></div>
        <div class="form-group"><label>Programa</label><select [(ngModel)]="novoCardData.programa" name="programa">
            <option value="enem">Se Liga no Enem</option>
            <option value="rieh">Outras Produ√ß√µes</option>
          </select></div>
      </div>
      <div class="form-row-wide" style="grid-template-columns: 1fr 1fr 1fr;">
        <div class="form-group"><label>Prazo de Entrega</label><input type="date" [(ngModel)]="novoCardData.prazo"
            name="prazo"></div>
        <div class="form-group"><label>Respons√°vel</label><select [(ngModel)]="novoCardData.responsavel"
            name="responsavel">
            <option value="">-- Pendente --</option>
            <option *ngFor="let op of listaOperacionais" [value]="op.id">{{ op.nome }} ({{ op.perfil }})</option>
          </select></div>
        <div class="form-group"><label>Iniciar em</label><select [(ngModel)]="novoCardData.listaId" name="listaId">
            <option value="standby">Standby</option>
            <option value="para-producao-semanal">Para Produ√ß√£o Semanal</option>
            <option value="gravado">Gravado</option>
          </select></div>
      </div>
      <div class="workflow-section"><label class="section-label">Defini√ß√£o das Etapas (Marque o que se aplica)</label>
        <div class="workflow-grid">
          <div class="workflow-item" *ngFor="let etapa of etapasWorkflow"><input type="checkbox"
              [id]="'check-' + etapa.key" [(ngModel)]="etapasSelecionadas[etapa.key]"
              [name]="'check-' + etapa.key"><label [for]="'check-' + etapa.key">{{ etapa.label }}</label></div>
        </div>
      </div>
      <div class="modal-actions"><button type="button" class="btn-sair" (click)="closeModal()">Cancelar</button><button
          type="submit" class="btn-novo-card">Confirmar e Criar</button></div>
    </form>
  </div>
</div>